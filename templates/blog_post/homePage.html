{% extends "login_register/base.html" %}

{% block title %}Home Page{% endblock title %}

{% block body %}
<style>
.text {
   overflow: hidden;
   text-overflow: ellipsis;
   display: -webkit-box;
   -webkit-line-clamp: 3; /* number of lines to show */
   -webkit-box-orient: vertical;
}
</style>
<div style="margin-bottom:600px; margin-top: 200px" class="mt-5 mb-3 col-lg-6 container">
    <form action="{% url 'add_post' %}" method="POST">
        {% csrf_token %}
        <div class="form-group">
            <label for="post"></label>
            <textarea class="form-control" placeholder="Say something. . ." id="post" rows="3" name="post"></textarea>
        </div>
        <!--<div class="form-group">
            <label for="file">File input</label>-->
            <input type="file" name="files[]" id="files">
            <br>
            <input type="hidden" name="url" id="url">
            <br>
            <button type="button" onclick="uploadimage()">Upload</button><br><br>
        <!--</div>-->
        <button style="background-color:#086375;" class="mt-9 btn btn-block text-white" type="submit">Post</button>
    </form>
    <script src="https://www.gstatic.com/firebasejs/8.8.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.0/firebase-storage.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.0/firebase-firestore.js"></script>
    <script>
        var firebaseConfig = {
            apiKey: 'AIzaSyCR1mvz5oDzyUfC6fk_Y56mgGXy7uVawCY',
            authDomain: 'pashe-achi-cse299.firebaseapp.com',
            databaseURL: 'https://pashe-achi-cse299-default-rtdb.firebaseio.com/',
            projectId: 'pashe-achi-cse299',
            storageBucket: 'pashe-achi-cse299.appspot.com',
            messagingSenderId: "798613820174",
            appId: '1:798613820174:web:8d03f5cf0fbae3e9dcbd5f',
            measurementId: 'G-TZN8WC3LJT'
        };
        firebase.initializeApp(firebaseConfig);
        function uploadimage(){
            var storage = firebase.storage();
            var storageRef = storage.ref();
            var file = document.getElementById("files").files[0];
            var thisref = storageRef.child(file.name).put(file);
            console.log(thisref);
            thisref.on("state_changed",function(snapshot){
                console.log("file uplaoded succesfully");
                },
                function(error) {
                },
                function() {
                    // Upload completed successfully, now we can get the download URL
                    var starsRef = storageRef.child(file.name);
                    // Get the download URL
                    starsRef.getDownloadURL()
                    .then((url) => {
                        document.getElementById("url").value = url;
                    console.log(url);
                    alert("File uploaded successfully");
                    })
                });
        }    
    </script>
    <br>
    {% for timeStampList, userNameList, dateTimeList, postList, totalLikesList, totalCommentsList, urlList in postDetails %}
        <div style="border-style: solid; border-color:#52b69a;" class="card mb-3">
            <div class="card-body">
                <div class="position-relative">
                    <div class="clearfix">
                        <h5 class="font-weight-bold card-title float-left">{{userNameList}}</h5>
                        <h5 class="font-weight-bold card-title float-right">{{dateTimeList}}</h5>
                    </div>
                    {% if urlList == 0 %}
                        <p style="text-align:justify" class="lead card-text text">{{postList}}</p>
                    {% else %}
                    <p style="text-align:justify" class="lead card-text text">{{postList}}</p>
                    <center>
                        <img style="height: 100%; width: 100%; object-fit: contain;" src={{urlList}}>
                    </center>
                        
                    {% endif %}
                    <!--<a href="{% url 'post_details' timeStampList  %}" class="stretched-link"></a>-->
                </div>
                <br>
                <div class="clearfix">
                    <div class="d-flex flex-row float-left">
                        <form method="POST" action="{% url 'like' timeStampList %}">
                            {% csrf_token %}
                            <input type="hidden" name="next" value=" ">
                            <button style="background-color: transparent; border:none; box-shadow:none;" type= "submit">
                                <i class="far fa-thumbs-up fa-lg"><span>{{totalLikesList}}</span></i>
                            </button>
                        </form>
                        <div class="position-relative">
                            <button style="background-color: transparent; border:none; box-shadow:none;">
                                <i class="far fa-comment-dots fa-lg"><span>{{totalCommentsList}}</span></i>
                                <a href="{% url 'post_details' timeStampList  %}" class="stretched-link"></a>
                            </button>
                        </div>
                    </div>
                    <h5 style="color:#52b69a;" class="font-weight-light float-right">Details
                        <i style="margin-left: 5px;" class="fas fa-angle-double-right"></i> 
                        <a href="{% url 'post_details' timeStampList  %}" class="stretched-link"></a>
                    </h5>
                </div>
            </div>
        </div>
    {% endfor %}
    <br>
</div>
{% endblock body %}